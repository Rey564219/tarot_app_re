MAJOR_MEANINGS = {
    'The Fool': {
        'upright': {'short_meaning': '始まり・自由・無邪気・警戒心の欠如', 'keywords': ['始動', '自由', '冒険']},
        'reversed': {'short_meaning': '無計画・軽率・空回り・忠告・賢明さ', 'keywords': ['衝動', '浅はか', '混乱']},
    },
    'The Magician': {
        'upright': {'short_meaning': '実現力・集中・技能', 'keywords': ['創造', '意志', '器用']},
        'reversed': {'short_meaning': '操作・散漫・虚栄・ペテン', 'keywords': ['ごまかし', '迷走', '未熟','欺瞞']},
    },
    'The High Priestess': {
        'upright': {'short_meaning': '直感・内なる知恵・静けさ', 'keywords': ['洞察', '秘密', '内省']},
        'reversed': {'short_meaning': '迷い・鈍化・閉鎖的・妄想癖・不信感', 'keywords': ['不信', '混乱', '誤解','妄想癖']},
    },
    'The Empress': {
        'upright': {'short_meaning': '豊かさ・育成・愛情', 'keywords': ['実り', '包容', '成長']},
        'reversed': {'short_meaning': '過保護・停滞・依存・堕落', 'keywords': ['甘え', '惰性', '停滞']},
    },
    'The Emperor': {
        'upright': {'short_meaning': '秩序・責任・統率・権威', 'keywords': ['安定', '計画', '権威']},
        'reversed': {'short_meaning': '支配・硬直・独裁', 'keywords': ['頑固', '圧力', '支配']},
    },
    'The Hierophant': {
        'upright': {'short_meaning': '伝統・学び・助言', 'keywords': ['指導', '信念', '保守','結婚','仲裁']},
        'reversed': {'short_meaning': '反発・形式主義・閉塞・インモラル', 'keywords': ['反抗', '古い慣習', '停滞','インモラル']},
    },
    'The Lovers': {
        'upright': {'short_meaning': '選択・調和・絆', 'keywords': ['恋愛', '一致', '決断']},
        'reversed': {'short_meaning': '不一致・誘惑・迷い・浮気', 'keywords': ['ズレ', '葛藤', '不安定', '浮気']},
    },
    'The Chariot': {
        'upright': {'short_meaning': '前進・勝利・意志', 'keywords': ['突破', '行動力', '集中']},
        'reversed': {'short_meaning': '暴走・停滞・葛藤', 'keywords': ['空回り', '迷走', '衝突']},
    },
    'Strength': {
        'upright': {'short_meaning': '勇気・自制・思いやり', 'keywords': ['克服', '優しさ', '芯']},
        'reversed': {'short_meaning': '不安・弱さ・自己否定・バランスを崩す', 'keywords': ['自信不足', '焦り', '不安定']},
    },
    'The Hermit': {
        'upright': {'short_meaning': '内省・探求・孤高', 'keywords': ['熟考', '静寂', '深掘り']},
        'reversed': {'short_meaning': '孤立・閉塞・回避', 'keywords': ['孤独', '逃避', '停滞']},
    },
    'Wheel of Fortune': {
        'upright': {'short_meaning': '転機・循環・好機', 'keywords': ['変化', '運', '流れ']},
        'reversed': {'short_meaning': '停滞・不運・抵抗', 'keywords': ['足踏み', '逆風', '停滞']},
    },
    'Justice': {
        'upright': {'short_meaning': '公平・判断・因果', 'keywords': ['真実', '均衡', '責任']},
        'reversed': {'short_meaning': '不公平・偏り・不正', 'keywords': ['不均衡', '誤判断', '不誠実']},
    },
    'The Hanged Man': {
        'upright': {'short_meaning': '受容・視点転換・献身', 'keywords': ['保留', '学び', '忍耐']},
        'reversed': {'short_meaning': '停滞・犠牲感・手詰まり・流れが変わる', 'keywords': ['無駄', '行き詰まり', '不満']},
    },
    'Death': {
        'upright': {'short_meaning': '終わりと再生・変化', 'keywords': ['転換', '区切り', '再出発']},
        'reversed': {'short_meaning': '拒絶・執着・惰性・生まれ変わり', 'keywords': ['手放せない', '停滞', '恐れ','生まれ変わり']},
    },
    'Temperance': {
        'upright': {'short_meaning': '調和・節度・癒し・新展開・対話', 'keywords': ['中庸', '調整', '回復', '新展開', '対話']},
        'reversed': {'short_meaning': '不調和・極端・過剰', 'keywords': ['アンバランス', '焦り', '乱れ']},
    },
    'The Devil': {
        'upright': {'short_meaning': '束縛・欲望・執着・悪意', 'keywords': ['依存', '誘惑', '固定観念','悪意と執着']},
        'reversed': {'short_meaning': '解放・自覚・断ち切り・軽度の悪意', 'keywords': ['覚醒', '解放', '脱却']},
    },
    'The Tower': {
        'upright': {'short_meaning': '崩壊・衝撃・刷新・コミュニケーションエラー', 'keywords': ['破壊', '真実', '転換','一目ぼれ','コミュニケーションエラー']},
        'reversed': {'short_meaning': '回避・先延ばし・内側の崩れ', 'keywords': ['恐れ', '遅延', '不安定']},
    },
    'The Star': {
        'upright': {'short_meaning': '希望・癒し・導き', 'keywords': ['回復', '信頼', '未来']},
        'reversed': {'short_meaning': '失望・不信・消耗', 'keywords': ['落胆', '不安', '疲労']},
    },
    'The Moon': {
        'upright': {'short_meaning': '不安・幻想・直感・ロマンス', 'keywords': ['迷い', '曖昧', '夢']},
        'reversed': {'short_meaning': '混乱・誤解・不安定・状態が判明する', 'keywords': ['錯覚', '疑念', '不確実','状態が判明する']},
    },
    'The Sun': {
        'upright': {'short_meaning': '成功・喜び・明快', 'keywords': ['達成', '祝福', '明るさ']},
        'reversed': {'short_meaning': '過信・消耗・遅れ・太陽が陰る', 'keywords': ['空回り', '疲労', '延期']},
    },
    'Judgement': {
        'upright': {'short_meaning': '目覚め・評価・決断・報われる', 'keywords': ['再起', '判断', '赦し']},
        'reversed': {'short_meaning': '停滞・後悔・先送り', 'keywords': ['迷い', '不安', '逃避']},
    },
    'The World': {
        'upright': {'short_meaning': '完成・達成・統合', 'keywords': ['成就', '完結', '統一','妊娠']},
        'reversed': {'short_meaning': '未完成・停滞・視野狭窄', 'keywords': ['中断', '遅延', '未熟']},
    },
}

SUIT_RANK_MEANINGS = {
    'Wands': {
        'Ace': ('情熱の始まり', ['着火', '挑戦', '創造'], '意欲低下', ['空回り', '消耗', '停滞']),
        'Two': ('計画と選択', ['展望', '決断', '準備'], '迷いと遅れ', ['躊躇', '不安', '停滞']),
        'Three': ('前進と拡大', ['進展', '成長', '期待'], '停滞と見通し不良', ['遅延', '不安', '停滞']),
        'Four': ('安定と祝福', ['達成', '休息', '喜び'], '落ち着かない', ['不満', '疲労', '不安定']),
        'Five': ('競争と摩擦', ['対立', '切磋', '挑戦'], '衝突回避', ['妥協', '回避', '疲れ']),
        'Six': ('勝利と評価', ['達成', '注目', '成功'], '過信と失速', ['傲慢', '失敗', '停滞']),
        'Seven': ('防衛と主張', ['踏ん張り', '防御', '努力'], '守り過ぎ', ['迷い', '不安', '弱気']),
        'Eight': ('急展開と加速', ['進行', '連絡', 'スピード'], '停滞と遅延', ['遅れ', '混乱', '障害']),
        'Nine': ('粘り強さ', ['耐久', '警戒', '継続'], '疲弊と限界', ['消耗', '警戒過多', '不安']),
        'Ten': ('重荷と責任', ['負担', '努力', '達成直前'], '抱え込み過多', ['疲労', '限界', '放棄']),
        'Page': ('好奇心と学び', ['開始', '探求', '若さ'], '未熟と散漫', ['気まぐれ', '未熟', '不安定']),
        'Knight': ('突進と情熱', ['行動', '挑戦', '勢い'], '衝動と無計画', ['暴走', '焦り', '混乱']),
        'Queen': ('自信と魅力', ['情熱', '人望', '前向き'], '感情的', ['苛立ち', '不安', '気分屋']),
        'King': ('統率と実行', ['指導', '決断', '実行力'], '独断と強引', ['頑固', '圧', '空回り']),
    },
    'Cups': {
        'Ace': ('愛情の芽生え', ['感情', '優しさ', '直感'], '感情の停滞', ['失望', '閉塞', '不安']),
        'Two': ('相思相愛', ['協力', '調和', '絆'], '不一致', ['誤解', '距離', '不安定']),
        'Three': ('喜びの共有', ['祝福', '友情', '楽しさ'], '過度な享楽', ['散漫', '浪費', 'だらけ']),
        'Four': ('内省と退屈', ['熟考', '休息', '再評価'], '機会損失', ['無気力', '後悔', '停滞']),
        'Five': ('喪失と悲しみ', ['失望', '後悔', '嘆き'], '受容と回復', ['立ち直り', '希望', '前進']),
        'Six': ('思い出と純粋さ', ['回想', '優しさ', '郷愁'], '過去への執着', ['停滞', '依存', '後退']),
        'Seven': ('幻想と選択', ['夢', '迷い', '想像'], '現実への集中', ['決断', '整理', '目覚め']),
        'Eight': ('見切りと前進', ['離脱', '探索', '自立'], '踏み出せない', ['未練', '停滞', '迷い']),
        'Nine': ('満足と充足', ['達成', '幸福', '余裕'], 'わがまま', ['過信', '不満', '虚無']),
        'Ten': ('家族の幸福', ['調和', '祝福', '完結'], '表面だけの幸せ', ['不和', '理想過多', '不満']),
        'Page': ('感受性と学び', ['直感', '優しさ', '好奇心'], '不安定', ['過敏', '気まぐれ', '迷い']),
        'Knight': ('ロマンスと追求', ['告白', '情熱', '行動'], '逃避と気分屋', ['空想', '迷走', '不安']),
        'Queen': ('共感と包容', ['思いやり', '癒し', '直感'], '依存的', ['過干渉', '不安', '疲労']),
        'King': ('成熟と寛容', ['落ち着き', '理解', '支え'], '感情を抑えすぎ', ['無関心', '抑圧', '冷淡']),
    },
    'Swords': {
        'Ace': ('真実と決断', ['明確', '突破', '判断'], '混乱と誤解', ['誤判断', '曖昧', '迷い']),
        'Two': ('静かな選択', ['保留', '均衡', '熟考'], '優柔不断', ['回避', '停滞', '不安']),
        'Three': ('痛みと気づき', ['失恋', '悲しみ', '真実'], '回復の兆し', ['癒し', '受容', '前進']),
        'Four': ('休息と回復', ['回復', '静養', '内省'], '不眠と不安', ['疲労', '焦り', '消耗']),
        'Five': ('対立と損失', ['衝突', '勝ち負け', '緊張'], '和解の兆し', ['妥協', '修復', '反省']),
        'Six': ('移動と癒し', ['移行', '回復', '旅'], '過去への執着', ['停滞', '後退', '迷い']),
        'Seven': ('策略と慎重', ['駆け引き', '工夫', '用心'], '露見と失敗', ['後悔', '失策', '警告']),
        'Eight': ('束縛と制限', ['閉塞', '不安', '孤立'], '解放の兆し', ['突破', '気づき', '前進']),
        'Nine': ('不安と恐れ', ['心配', '悪夢', '焦り'], '緩和と回復', ['安心', '軽減', '立ち直り']),
        'Ten': ('終わりと決着', ['限界', '終了', '痛み'], '再出発', ['回復', '再生', '希望']),
        'Page': ('好奇心と情報', ['学び', '観察', '警戒'], '噂と混乱', ['誤解', '軽率', '不信']),
        'Knight': ('迅速な行動', ['突破', '正義感', '決断'], '強引さ', ['衝動', '過激', '混乱']),
        'Queen': ('鋭さと自立', ['合理性', '洞察', '判断'], '冷たさ', ['辛辣', '孤立', '頑固']),
        'King': ('論理と統率', ['理性', '戦略', '公平'], '頑固と支配', ['独断', '冷徹', '偏り']),
    },
    'Pentacles': {
        'Ace': ('現実的な始まり', ['資金', '好機', '実行'], '機会損失', ['遅延', '不安', '不足']),
        'Two': ('バランスと調整', ['両立', '工夫', '柔軟'], '乱れ', ['不安定', '混乱', '過労']),
        'Three': ('協力と成果', ['評価', 'チーム', '成長'], '未熟', ['品質不足', '停滞', '不一致']),
        'Four': ('安定と保守', ['確保', '節約', '安全'], '執着と停滞', ['固執', '不安', '閉塞']),
        'Five': ('困難と不足', ['貧困', '不安', '孤立'], '回復の兆し', ['支援', '改善', '希望']),
        'Six': ('与える・受け取る', ['援助', '公平', '調和'], '偏り', ['不公平', '負担', '不満']),
        'Seven': ('努力と待ち', ['成長', '評価待ち', '忍耐'], '焦り', ['停滞', '不満', '短気']),
        'Eight': ('熟練と積み上げ', ['練習', '技能', '努力'], '手抜き', ['中途半端', '雑', '不満']),
        'Nine': ('自立と実り', ['達成', '豊かさ', '余裕'], '孤独と過信', ['不安', '浪費', '虚無']),
        'Ten': ('長期的安定', ['家族', '資産', '継続'], '不安定', ['崩れ', '過負担', '停滞']),
        'Page': ('学びと実務', ['学習', '計画', '堅実'], '停滞', ['怠け', '遅れ', '不安']),
        'Knight': ('着実な前進', ['堅実', '努力', '忍耐'], '停滞と惰性', ['保守的', '遅い', '退屈']),
        'Queen': ('実用性と豊かさ', ['管理', '実務', '育成'], '心配性', ['過保護', '不安', '執着']),
        'King': ('安定と達成', ['統率', '信頼', '成功'], '硬直', ['頑固', '独断', '停滞']),
    },
}


def _build_minor_meanings() -> dict:
    meanings = {}
    for suit, ranks in SUIT_RANK_MEANINGS.items():
        for rank, data in ranks.items():
            upright_meaning, upright_keywords, reversed_meaning, reversed_keywords = data
            name = f'{rank} of {suit}'
            meanings[name] = {
                'upright': {'short_meaning': upright_meaning, 'keywords': upright_keywords},
                'reversed': {'short_meaning': reversed_meaning, 'keywords': reversed_keywords},
            }
    return meanings


CARD_MEANINGS = {**MAJOR_MEANINGS, **_build_minor_meanings()}


def get_card_meaning(card_name: str, upright: bool | None) -> dict | None:
    if not card_name:
        return None
    meaning = CARD_MEANINGS.get(card_name)
    if not meaning:
        return None
    if upright is True:
        return meaning.get('upright')
    if upright is False:
        return meaning.get('reversed')
    return meaning.get('upright') or meaning.get('reversed')
